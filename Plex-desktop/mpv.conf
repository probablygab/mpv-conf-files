# Process priority
priority=high

# Uses GPU-accelerated video output by default.
vo=gpu-next
gpu-api=d3d11
vd-lavc-dr=yes   
gpu-context=auto
hwdec-codecs=all
hwdec=d3d11va-copy
#d3d11va-zero-copy=yes
d3d11-exclusive-fs=yes

# Match display Hz
video-sync=display-resample

# Sets a custom font
osd-font=Segoe UI
osd-font-size=20
osd-outline-size=1.4
osd-scale=0.8

# Image processing
dither-depth=10

# Disable deband in case of performance issues
deband=no
deband-iterations=4
deband-threshold=48
deband-range=16
deband-grain=48


# ==== Subtitle config ==== #

sid=auto
blend-subtitles=no


# ==== Volume config ==== #

# Use WASAPI
ao=wasapi

# Use mpv with other audio applications
audio-exclusive=no

# https://mpv.io/manual/master/#options-volume
# Set volume and max volume to 100 to avoid attenuation
volume=100
volume-max=100
volume-gain=0.0

# Output settings
audio-samplerate=48000
audio-normalize-downmix=yes

# Surround to stereo
[Downmix-Audio-5.1]
profile-cond=get("audio-params/channel-count") >= 5 and get("audio-params/channel-count") < 7
profile-restore=copy-equal

af=lavfi="lowpass=c=LFE:f=120,volume=1.6,pan=stereo|FL=0.5*FC+0.707*FL+0.707*BL+0.5*LFE|FR=0.5*FC+0.707*FR+0.707*BR+0.5*LFE"

[Downmix-Audio-7.1]
profile-cond=get("audio-params/channel-count") >= 7
profile-restore=copy-equal

af=lavfi="lowpass=c=LFE:f=120,volume=1.6,pan=stereo|FL=0.5*FC+0.3*FLC+0.3*FL+0.3*BL+0.3*SL+0.5*LFE|FR=0.5*FC+0.3*FRC+0.3*FR+0.3*BR+0.3*SR+0.5*LFE"


# ==== HDR config ==== #

# Automatically switch to HDR mode when playing HDR content
[HDR-DV]
profile-cond=(p["video-params/primaries"] == "bt.2020") and (p["video-params/gamma"] == "pq")

# HDR pass-through, no effect on SDR content
target-colorspace-hint=yes

# Set primaries, transfer characteristics, and matrix coefficients
target-trc=pq
target-prim=bt.2020
hdr-compute-peak=yes
dolbyvision=yes

# HDR peak luminance
target-peak=400
sub-hdr-peak=400 # Subtitle peak 
target-contrast=10000 # inf if OLED

# D3D11
d3d11-output-csp=pq
d3d11-output-format=rgba16f
video-output-levels=full


# ==== Animejanai Upscaling Profiles ==== #

[upscale-off]
vf=

[upscale-on-quality]
vf='vapoursynth="C:/Program Files/Plex/Plex/animejanai/profiles/animejanai_quality.vpy":buffered-frames=1:concurrent-frames=8'

[upscale-on-balanced]
vf='vapoursynth="C:/Program Files/Plex/Plex/animejanai/profiles/animejanai_balanced.vpy":buffered-frames=1:concurrent-frames=8'

[upscale-on-performance]
vf='vapoursynth="C:/Program Files/Plex/Plex/animejanai/profiles/animejanai_performance.vpy":buffered-frames=1:concurrent-frames=8'

[upscale-on-1]
vf='vapoursynth="C:/Program Files/Plex/Plex/animejanai/profiles/animejanai_1.vpy":buffered-frames=1:concurrent-frames=8'

[upscale-on-2]
vf='vapoursynth="C:/Program Files/Plex/Plex/animejanai/profiles/animejanai_2.vpy":buffered-frames=1:concurrent-frames=8'

[upscale-on-3]
vf='vapoursynth="C:/Program Files/Plex/Plex/animejanai/profiles/animejanai_3.vpy":buffered-frames=1:concurrent-frames=8'

[upscale-on-4]
vf='vapoursynth="C:/Program Files/Plex/Plex/animejanai/profiles/animejanai_4.vpy":buffered-frames=1:concurrent-frames=8'

[upscale-on-5]
vf='vapoursynth="C:/Program Files/Plex/Plex/animejanai/profiles/animejanai_5.vpy":buffered-frames=1:concurrent-frames=8'

[upscale-on-6]
vf='vapoursynth="C:/Program Files/Plex/Plex/animejanai/profiles/animejanai_6.vpy":buffered-frames=1:concurrent-frames=8'

[upscale-on-7]
vf='vapoursynth="C:/Program Files/Plex/Plex/animejanai/profiles/animejanai_7.vpy":buffered-frames=1:concurrent-frames=8'

[upscale-on-8]
vf='vapoursynth="C:/Program Files/Plex/Plex/animejanai/profiles/animejanai_8.vpy":buffered-frames=1:concurrent-frames=8'

[upscale-on-9]
vf='vapoursynth="C:/Program Files/Plex/Plex/animejanai/profiles/animejanai_9.vpy":buffered-frames=1:concurrent-frames=8'

[default]
profile=upscale-on-balanced

# ==== Animejanai Upscaling Profiles end ==== #